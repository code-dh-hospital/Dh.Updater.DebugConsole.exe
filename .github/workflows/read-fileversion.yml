name: Read FileVersion on Push

on:
  push:
    branches:
      - main
      - master
      - develop

jobs:
  get-file-version:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set EXE path
        run: echo "EXE_PATH=bin/Release/net8.0/MyApp.exe" >> $GITHUB_ENV

      - name: Extract FileVersion
        id: fileversion
        run: |
          FILE="$EXE_PATH"
          echo "ðŸ“Œ File: $FILE"

          if [ ! -f "$FILE" ]; then
            echo "âŒ File khÃ´ng tá»“n táº¡i: $FILE"
            exit 1
          fi

          RAW=$(strings "$FILE" | grep -E "FileVersion|ProductVersion|AssemblyFileVersion" || true)

          echo "ðŸ”Ž Raw version lines:"
          echo "$RAW"

          VERSION=$(echo "$RAW" | grep -oE '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+' | head -n1)

          if [ -z "$VERSION" ]; then
            VERSION=$(strings "$FILE" | grep -oE '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+' | head -n1)
          fi

          if [ -z "$VERSION" ]; then
            echo "âŒ KhÃ´ng tÃ¬m Ä‘Æ°á»£c FileVersion."
            exit 1
          fi

          echo "âœ… Detected FileVersion: $VERSION"
          echo "file_version=$VERSION" >> "$GITHUB_OUTPUT"
